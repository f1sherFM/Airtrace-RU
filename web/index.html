<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AirTrace RU — Мониторинг качества воздуха</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.2); }
        .aqi-gradient { background: linear-gradient(135deg, #00b4db 0%, #0083b0 100%); }
        .aqi-good { background: linear-gradient(135deg, #00E400 0%, #00b300 100%); }
        .aqi-moderate { background: linear-gradient(135deg, #FFFF00 0%, #e6e600 100%); }
        .aqi-unhealthy-sensitive { background: linear-gradient(135deg, #FF7E00 0%, #e66a00 100%); }
        .aqi-unhealthy { background: linear-gradient(135deg, #FF0000 0%, #cc0000 100%); }
        .aqi-very-unhealthy { background: linear-gradient(135deg, #8F3F97 0%, #7a3582 100%); }
        .aqi-hazardous { background: linear-gradient(135deg, #7E0023 0%, #5c0019 100%); }
        .loading { animation: pulse 2s infinite; }
        .error { background: linear-gradient(135deg, #ff4444 0%, #cc0000 100%); }
        .city-input { background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(8px); }
        .forecast-card { transition: all 0.3s ease; }
        .forecast-card:hover { transform: translateY(-2px); }
    </style>
</head>
<body class="aqi-gradient min-h-screen text-white p-4 md:p-8" id="body">

    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
            <div>
                <h1 class="text-3xl font-bold flex items-center gap-3">
                    <i data-lucide="wind" class="text-blue-200 w-8 h-8"></i> AirTrace RU
                </h1>
                <p class="text-blue-100 text-sm opacity-80 mt-1" id="location-display">Выберите город для мониторинга</p>
            </div>
            
            <!-- City Selection -->
            <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto">
                <select id="city-select" class="city-input rounded-xl px-4 py-2 text-white border border-white/20 focus:outline-none focus:ring-2 focus:ring-blue-300">
                    <option value="">Выберите город</option>
                    <option value="55.7558,37.6176">Москва</option>
                    <option value="59.9311,30.3609">Санкт-Петербург</option>
                    <option value="53.4069,58.9794">Магнитогорск</option>
                    <option value="56.8431,60.6454">Екатеринбург</option>
                    <option value="55.0084,82.9357">Новосибирск</option>
                    <option value="55.1644,61.4368">Челябинск</option>
                    <option value="56.3269,44.0075">Нижний Новгород</option>
                    <option value="53.2001,50.15">Самара</option>
                </select>
                
                <div class="flex gap-2">
                    <button id="refresh-btn" class="bg-white/20 hover:bg-white/30 rounded-xl px-4 py-2 transition-colors flex items-center gap-2">
                        <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                        <span class="hidden md:inline">Обновить</span>
                    </button>
                    
                    <div class="flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full animate-pulse" id="status-indicator"></span>
                        <span class="text-xs" id="status-text">Загрузка...</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-6" id="main-content">
            
            <!-- Loading State -->
            <div id="loading-state" class="lg:col-span-3 glass rounded-3xl p-8 text-center">
                <div class="loading">
                    <i data-lucide="loader" class="w-12 h-12 mx-auto mb-4 animate-spin"></i>
                    <p class="text-lg">Выберите город для получения данных о качестве воздуха</p>
                </div>
            </div>

            <!-- Error State -->
            <div id="error-state" class="lg:col-span-3 glass rounded-3xl p-8 text-center hidden">
                <i data-lucide="alert-triangle" class="w-12 h-12 mx-auto mb-4 text-red-400"></i>
                <p class="text-lg mb-2">Ошибка загрузки данных</p>
                <p class="text-sm opacity-70" id="error-message"></p>
                <button onclick="loadAirQualityData()" class="mt-4 bg-white/20 hover:bg-white/30 rounded-xl px-6 py-2 transition-colors">
                    Попробовать снова
                </button>
            </div>

            <!-- AQI Main Card -->
            <div id="aqi-card" class="lg:col-span-2 glass rounded-3xl p-8 flex flex-col justify-between relative overflow-hidden hidden">
                <div class="relative z-10">
                    <h2 class="text-lg font-medium opacity-80 mb-1">Индекс качества воздуха (AQI)</h2>
                    <div class="flex items-baseline gap-4">
                        <span class="text-8xl font-bold" id="aqi-value">--</span>
                        <span class="text-2xl font-semibold" id="aqi-category">--</span>
                    </div>
                    <p class="mt-4 max-w-sm text-blue-50 opacity-90" id="aqi-description">
                        Загрузка данных...
                    </p>
                </div>
                
                <div class="mt-8 p-4 bg-white/10 rounded-2xl flex items-start gap-3">
                    <i data-lucide="info" class="shrink-0"></i>
                    <p class="text-sm" id="recommendations">Загрузка рекомендаций...</p>
                </div>
            </div>

            <!-- Side Info -->
            <div id="side-info" class="flex flex-col gap-6 hidden">
                <!-- NMU Risk -->
                <div class="glass rounded-3xl p-6 border-l-4" id="nmu-card">
                    <h3 class="text-sm font-semibold opacity-70 uppercase tracking-wider mb-2">Риск НМУ</h3>
                    <div class="flex items-center gap-3">
                        <i id="nmu-icon" class="w-8 h-8"></i>
                        <div>
                            <p class="font-bold" id="nmu-level">--</p>
                            <p class="text-xs opacity-60" id="nmu-description">Загрузка...</p>
                        </div>
                    </div>
                </div>

                <!-- Coordinates -->
                <div class="glass rounded-3xl p-6">
                    <h3 class="text-sm font-semibold opacity-70 uppercase tracking-wider mb-4">Координаты (Privacy Safe)</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between text-sm">
                            <span class="opacity-60">Широта</span>
                            <span class="font-mono" id="latitude">--</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="opacity-60">Долгота</span>
                            <span class="font-mono" id="longitude">--</span>
                        </div>
                        <div class="flex justify-between text-sm">
                            <span class="opacity-60">Обновлено</span>
                            <span class="text-xs" id="last-updated">--</span>
                        </div>
                    </div>
                </div>

                <!-- Health Warnings -->
                <div id="health-warnings" class="glass rounded-3xl p-6 hidden">
                    <h3 class="text-sm font-semibold opacity-70 uppercase tracking-wider mb-4">Предупреждения</h3>
                    <div id="warnings-list" class="space-y-2">
                        <!-- Warnings will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Pollutants Grid -->
            <div id="pollutants-grid" class="lg:col-span-3 grid grid-cols-2 md:grid-cols-5 gap-4 hidden">
                <div class="glass rounded-2xl p-4 text-center">
                    <p class="text-xs opacity-60 mb-1">PM2.5</p>
                    <p class="text-xl font-bold" id="pm25-value">--</p>
                    <p class="text-[10px] opacity-40">мкг/м³</p>
                </div>
                <div class="glass rounded-2xl p-4 text-center">
                    <p class="text-xs opacity-60 mb-1">PM10</p>
                    <p class="text-xl font-bold" id="pm10-value">--</p>
                    <p class="text-[10px] opacity-40">мкг/м³</p>
                </div>
                <div class="glass rounded-2xl p-4 text-center">
                    <p class="text-xs opacity-60 mb-1">NO2</p>
                    <p class="text-xl font-bold" id="no2-value">--</p>
                    <p class="text-[10px] opacity-40">мкг/м³</p>
                </div>
                <div class="glass rounded-2xl p-4 text-center">
                    <p class="text-xs opacity-60 mb-1">SO2</p>
                    <p class="text-xl font-bold" id="so2-value">--</p>
                    <p class="text-[10px] opacity-40">мкг/м³</p>
                </div>
                <div class="glass rounded-2xl p-4 text-center">
                    <p class="text-xs opacity-60 mb-1">O3</p>
                    <p class="text-xl font-bold" id="o3-value">--</p>
                    <p class="text-[10px] opacity-40">мкг/м³</p>
                </div>
            </div>

            <!-- Forecast Section -->
            <div id="forecast-section" class="lg:col-span-3 hidden">
                <h3 class="text-xl font-semibold mb-4 flex items-center gap-2">
                    <i data-lucide="calendar" class="w-5 h-5"></i>
                    Прогноз на 24 часа
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4" id="forecast-grid">
                    <!-- Forecast cards will be populated here -->
                </div>
            </div>
        </main>

        <!-- Footer -->
        <footer class="mt-12 text-center opacity-40 text-xs">
            <p>© 2026 AirTrace RU. Данные: Open-Meteo API. Стандарты ПДК РФ. Privacy-first архитектура.</p>
        </footer>
    </div>

    <script src="app.js"></script>
    <script>
        // Инициализация иконок Lucide
        lucide.createIcons();
    </script>
</body>
</html>