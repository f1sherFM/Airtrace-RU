{% extends "base.html" %}

{% block title %}{{ title }}{% endblock %}

{% block content %}
<div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
    
    <!-- –§–æ—Ä–º–∞ –≤–≤–æ–¥–∞ -->
    <div class="glass-enhanced rounded-3xl p-8">
        <h2 class="text-2xl font-bold mb-6 flex items-center gap-3">
            <i data-lucide="map-pin" class="w-6 h-6 text-blue-400"></i>
            –ü—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π –≥–æ—Ä–æ–¥
        </h2>
        
        <form id="custom-city-form" method="post" action="/custom" class="space-y-6">
            <!-- –ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) -->
            <div>
                <label for="city_name" class="block text-sm font-medium mb-2 opacity-80">
                    –ù–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
                </label>
                <input 
                    type="text" 
                    id="city_name" 
                    name="city_name" 
                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫"
                    class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent"
                >
            </div>
            
            <!-- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã -->
            <div class="space-y-4">
                <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ñ–æ—Ä–º–∞—Ç–∞ -->
                <fieldset class="mb-4" aria-labelledby="coord-format-label">
                    <legend id="coord-format-label" class="text-sm font-medium opacity-80 mb-2">–§–æ—Ä–º–∞—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç:</legend>
                    <div class="flex gap-2">
                        <button 
                            type="button" 
                            id="decimal-btn" 
                            onclick="switchFormat('decimal')"
                            class="px-3 py-1 rounded-lg text-xs bg-blue-500/30 border border-blue-500/50 transition-colors"
                        >
                            –î–µ—Å—è—Ç–∏—á–Ω—ã–µ
                        </button>
                        <button 
                            type="button" 
                            id="dms-btn" 
                            onclick="switchFormat('dms')"
                            class="px-3 py-1 rounded-lg text-xs bg-white/10 border border-white/20 hover:bg-white/20 transition-colors"
                        >
                            –ì—Ä–∞–¥—É—Å—ã-–º–∏–Ω—É—Ç—ã-—Å–µ–∫—É–Ω–¥—ã
                        </button>
                        <button 
                            type="button" 
                            id="text-btn" 
                            onclick="switchFormat('text')"
                            class="px-3 py-1 rounded-lg text-xs bg-white/10 border border-white/20 hover:bg-white/20 transition-colors"
                        >
                            –¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥
                        </button>
                    </div>
                </fieldset>
                
                <!-- –î–µ—Å—è—Ç–∏—á–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã -->
                <div id="decimal-inputs" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="lat" class="block text-sm font-medium mb-2 opacity-80">
                            –®–∏—Ä–æ—Ç–∞ <span class="text-red-400">*</span>
                        </label>
                        <input 
                            type="number" 
                            id="lat" 
                            name="lat" 
                            step="0.0001"
                            min="-90"
                            max="90"
                            placeholder="61.25"
                            required
                            class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent"
                        >
                        <p class="text-xs opacity-60 mt-1">–û—Ç -90 –¥–æ 90</p>
                    </div>
                    
                    <div>
                        <label for="lon" class="block text-sm font-medium mb-2 opacity-80">
                            –î–æ–ª–≥–æ—Ç–∞ <span class="text-red-400">*</span>
                        </label>
                        <input 
                            type="number" 
                            id="lon" 
                            name="lon" 
                            step="0.0001"
                            min="-180"
                            max="180"
                            placeholder="73.4333"
                            required
                            class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent"
                        >
                        <p class="text-xs opacity-60 mt-1">–û—Ç -180 –¥–æ 180</p>
                    </div>
                </div>
                
                <!-- –ì—Ä–∞–¥—É—Å—ã-–º–∏–Ω—É—Ç—ã-—Å–µ–∫—É–Ω–¥—ã -->
                <div id="dms-inputs" class="hidden space-y-4">
                    <!-- –®–∏—Ä–æ—Ç–∞ DMS -->
                    <div>
                        <label class="block text-sm font-medium mb-2 opacity-80">
                            –®–∏—Ä–æ—Ç–∞ <span class="text-red-400">*</span>
                        </label>
                        <div class="grid grid-cols-4 gap-2">
                            <input 
                                type="number" 
                                id="lat-deg" 
                                placeholder="61"
                                min="0" max="90"
                                class="px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400"
                            >
                            <input 
                                type="number" 
                                id="lat-min" 
                                placeholder="15"
                                min="0" max="59"
                                class="px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400"
                            >
                            <input 
                                type="number" 
                                id="lat-sec" 
                                placeholder="0"
                                min="0" max="59.999"
                                step="0.001"
                                class="px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400"
                            >
                            <select 
                                id="lat-dir"
                                class="px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-400"
                            >
                                <option value="N">–°</option>
                                <option value="S">–Æ</option>
                            </select>
                        </div>
                        <p class="text-xs opacity-60 mt-1">–ì—Ä–∞–¥—É—Å—ã | –ú–∏–Ω—É—Ç—ã | –°–µ–∫—É–Ω–¥—ã | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</p>
                    </div>
                    
                    <!-- –î–æ–ª–≥–æ—Ç–∞ DMS -->
                    <div>
                        <label class="block text-sm font-medium mb-2 opacity-80">
                            –î–æ–ª–≥–æ—Ç–∞ <span class="text-red-400">*</span>
                        </label>
                        <div class="grid grid-cols-4 gap-2">
                            <input 
                                type="number" 
                                id="lon-deg" 
                                placeholder="73"
                                min="0" max="180"
                                class="px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400"
                            >
                            <input 
                                type="number" 
                                id="lon-min" 
                                placeholder="26"
                                min="0" max="59"
                                class="px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400"
                            >
                            <input 
                                type="number" 
                                id="lon-sec" 
                                placeholder="0"
                                min="0" max="59.999"
                                step="0.001"
                                class="px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400"
                            >
                            <select 
                                id="lon-dir"
                                class="px-3 py-2 rounded-lg bg-white/10 border border-white/20 text-white focus:outline-none focus:ring-2 focus:ring-blue-400"
                            >
                                <option value="E">–í</option>
                                <option value="W">–ó</option>
                            </select>
                        </div>
                        <p class="text-xs opacity-60 mt-1">–ì—Ä–∞–¥—É—Å—ã | –ú–∏–Ω—É—Ç—ã | –°–µ–∫—É–Ω–¥—ã | –ù–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ</p>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ -->
                    <button 
                        type="button" 
                        onclick="convertDMSToDecimal()"
                        class="w-full bg-green-500/20 hover:bg-green-500/30 border border-green-500/50 rounded-xl px-4 py-2 text-sm font-medium transition-colors flex items-center justify-center gap-2"
                    >
                        <i data-lucide="calculator" class="w-4 h-4"></i>
                        –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –≤ –¥–µ—Å—è—Ç–∏—á–Ω—ã–µ
                    </button>
                </div>
                
                <!-- –¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç -->
                <div id="text-inputs" class="hidden space-y-4">
                    <div>
                        <label for="coord-text" class="block text-sm font-medium mb-2 opacity-80">
                            –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –ª—é–±–æ–º —Ñ–æ—Ä–º–∞—Ç–µ <span class="text-red-400">*</span>
                        </label>
                        <textarea 
                            id="coord-text" 
                            placeholder="–ü—Ä–∏–º–µ—Ä—ã:&#10;61¬∞15‚Ä≤00‚Ä≥ —Å. —à., 73¬∞26‚Ä≤00‚Ä≥ –≤. –¥.&#10;61¬∞15'00&quot; N, 73¬∞26'00&quot; E&#10;61 15 00 N 73 26 00 E&#10;61.25, 73.4333"
                            rows="4"
                            class="w-full px-4 py-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:ring-2 focus:ring-blue-400 focus:border-transparent resize-none"
                        ></textarea>
                        <p class="text-xs opacity-60 mt-1">–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è —Ä–∞–∑–ª–∏—á–Ω—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã –∑–∞–ø–∏—Å–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</p>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ -->
                    <button 
                        type="button" 
                        onclick="parseTextCoordinates()"
                        class="w-full bg-purple-500/20 hover:bg-purple-500/30 border border-purple-500/50 rounded-xl px-4 py-2 text-sm font-medium transition-colors flex items-center justify-center gap-2"
                    >
                        <i data-lucide="type" class="w-4 h-4"></i>
                        –†–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                    </button>
                </div>
            </div>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ -->
            <button 
                type="submit" 
                class="w-full btn-glass rounded-xl px-6 py-3 font-semibold flex items-center justify-center gap-2 hover:bg-white/25 transition-all"
            >
                <i data-lucide="search" class="w-5 h-5"></i>
                –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –æ –∫–∞—á–µ—Å—Ç–≤–µ –≤–æ–∑–¥—É—Ö–∞
            </button>
        </form>
    </div>
    
    <!-- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∏ –ø—Ä–∏–º–µ—Ä—ã -->
    <div class="space-y-6">
        <!-- –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è -->
        <div class="glass-enhanced rounded-3xl p-6">
            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <i data-lucide="info" class="w-5 h-5 text-blue-400"></i>
                –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
            </h3>
            <div class="space-y-3 text-sm opacity-90">
                <p>1. <strong>–í—ã–±–µ—Ä–∏—Ç–µ —Ñ–æ—Ä–º–∞—Ç –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç</strong>:</p>
                <ul class="ml-4 space-y-1 text-xs opacity-80">
                    <li>‚Ä¢ <strong>–î–µ—Å—è—Ç–∏—á–Ω—ã–µ</strong> ‚Äî –æ–±—ã—á–Ω—ã–µ —á–∏—Å–ª–∞ (61.25, 73.4333)</li>
                    <li>‚Ä¢ <strong>–ì—Ä–∞–¥—É—Å—ã-–º–∏–Ω—É—Ç—ã-—Å–µ–∫—É–Ω–¥—ã</strong> ‚Äî —Ä–∞–∑–¥–µ–ª—å–Ω—ã–µ –ø–æ–ª—è</li>
                    <li>‚Ä¢ <strong>–¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥</strong> ‚Äî —Å–∫–æ–ø–∏—Ä—É–π—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–∞–∫ –µ—Å—Ç—å</li>
                </ul>
                <p>2. <strong>–í–≤–µ–¥–∏—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã</strong> –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–µ–≥–æ –≤–∞—Å –º–µ—Å—Ç–∞</p>
                <p>3. <strong>–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ</strong> —É–∫–∞–∂–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥–æ—Ä–æ–¥–∞</p>
                <p>4. <strong>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É</strong> –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö</p>
                <p class="text-xs opacity-70 mt-4">
                    üí° –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –º–æ–∂–Ω–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏–∑ Google Maps, –Ø–Ω–¥–µ–∫—Å.–ö–∞—Ä—Ç –∏–ª–∏ –í–∏–∫–∏–ø–µ–¥–∏–∏
                </p>
                <p class="text-xs opacity-70">
                    üîÑ –¢–µ–∫—Å—Ç–æ–≤—ã–π –≤–≤–æ–¥ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∑–∞–ø–∏—Å–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
                </p>
            </div>
        </div>
        
        <!-- –ü—Ä–∏–º–µ—Ä—ã –≥–æ—Ä–æ–¥–æ–≤ -->
        <div class="glass-enhanced rounded-3xl p-6">
            <h3 class="text-lg font-semibold mb-4 flex items-center gap-2">
                <i data-lucide="map" class="w-5 h-5 text-green-400"></i>
                –ü—Ä–∏–º–µ—Ä—ã –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
            </h3>
            <div class="space-y-3">
                <div class="flex justify-between items-center p-3 bg-white/5 rounded-lg">
                    <div>
                        <div class="font-medium">–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫</div>
                        <div class="text-xs opacity-60">43.1056, 131.8735</div>
                    </div>
                    <button 
                        onclick="fillCoordinates(43.1056, 131.8735, '–í–ª–∞–¥–∏–≤–æ—Å—Ç–æ–∫')"
                        class="text-xs bg-blue-500/20 hover:bg-blue-500/30 px-2 py-1 rounded transition-colors"
                    >
                        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
                    </button>
                </div>
                
                <div class="flex justify-between items-center p-3 bg-white/5 rounded-lg">
                    <div>
                        <div class="font-medium">–°–æ—á–∏</div>
                        <div class="text-xs opacity-60">43.6028, 39.7342</div>
                    </div>
                    <button 
                        onclick="fillCoordinates(43.6028, 39.7342, '–°–æ—á–∏')"
                        class="text-xs bg-blue-500/20 hover:bg-blue-500/30 px-2 py-1 rounded transition-colors"
                    >
                        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
                    </button>
                </div>
                
                <div class="flex justify-between items-center p-3 bg-white/5 rounded-lg">
                    <div>
                        <div class="font-medium">–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥</div>
                        <div class="text-xs opacity-60">54.7104, 20.4522</div>
                    </div>
                    <button 
                        onclick="fillCoordinates(54.7104, 20.4522, '–ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥')"
                        class="text-xs bg-blue-500/20 hover:bg-blue-500/30 px-2 py-1 rounded transition-colors"
                    >
                        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
                    </button>
                </div>
                
                <div class="flex justify-between items-center p-3 bg-white/5 rounded-lg">
                    <div>
                        <div class="font-medium">–Ø–∫—É—Ç—Å–∫</div>
                        <div class="text-xs opacity-60">62.0355, 129.6755</div>
                    </div>
                    <button 
                        onclick="fillCoordinates(62.0355, 129.6755, '–Ø–∫—É—Ç—Å–∫')"
                        class="text-xs bg-blue-500/20 hover:bg-blue-500/30 px-2 py-1 rounded transition-colors"
                    >
                        –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å
                    </button>
                </div>
                
                <div class="flex justify-between items-center p-3 bg-white/5 rounded-lg">
                    <div>
                        <div class="font-medium">–°—É—Ä–≥—É—Ç</div>
                        <div class="text-xs opacity-60">61¬∞15‚Ä≤00‚Ä≥ —Å.—à., 73¬∞26‚Ä≤00‚Ä≥ –≤.–¥.</div>
                    </div>
                    <button 
                        onclick="fillTextExample()"
                        class="text-xs bg-purple-500/20 hover:bg-purple-500/30 px-2 py-1 rounded transition-colors"
                    >
                        –¢–µ–∫—Å—Ç –ø—Ä–∏–º–µ—Ä
                    </button>
                </div>
            </div>
        </div>
        
        <!-- –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ -->
        <div class="glass-enhanced rounded-3xl p-6 border-l-4 border-l-yellow-400">
            <h3 class="text-lg font-semibold mb-2 flex items-center gap-2">
                <i data-lucide="alert-triangle" class="w-5 h-5 text-yellow-400"></i>
                –í–∞–∂–Ω–æ –∑–Ω–∞—Ç—å
            </h3>
            <div class="text-sm opacity-90 space-y-2">
                <p>‚Ä¢ –î–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è—é—Ç—Å—è —Å–µ—Ä–≤–∏—Å–æ–º Open-Meteo</p>
                <p>‚Ä¢ –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è (privacy-first)</p>
                <p>‚Ä¢ –†–∞—Å—á–µ—Ç AQI –ø–æ —Ä–æ—Å—Å–∏–π—Å–∫–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –ü–î–ö</p>
                <p>‚Ä¢ –î–ª—è –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ä–µ–≥–∏–æ–Ω–æ–≤ –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã</p>
            </div>
        </div>
    </div>
</div>

<script>
let customNotificationCounter = 0;
function showNotification(message, type = 'info') {
    const colors = {
        success: 'bg-green-500/20 border-green-500/50 text-green-300',
        error: 'bg-red-500/20 border-red-500/50 text-red-300',
        info: 'bg-blue-500/20 border-blue-500/50 text-blue-300'
    };

    const liveRegion = document.getElementById('custom-notification-live');
    if (liveRegion) {
        liveRegion.textContent = message;
    }

    const notification = document.createElement('div');
    customNotificationCounter += 1;
    notification.className = `fixed top-4 right-4 ${colors[type]} border rounded-xl px-4 py-3 text-sm z-50 max-w-sm`;
    notification.setAttribute('role', 'status');
    notification.setAttribute('aria-live', 'polite');
    notification.setAttribute('id', `custom-notification-${customNotificationCounter}`);
    notification.innerHTML = `
        <div class="flex items-center gap-2">
            <i data-lucide="${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'info'}" class="w-4 h-4"></i>
            <span>${message}</span>
        </div>
    `;

    document.body.appendChild(notification);
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }
    setTimeout(() => notification.remove(), 3500);
}

function fillCoordinates(lat, lon, cityName) {
    document.getElementById('lat').value = lat;
    document.getElementById('lon').value = lon;
    document.getElementById('city_name').value = cityName;
}

function switchFormat(format) {
    const decimalInputs = document.getElementById('decimal-inputs');
    const dmsInputs = document.getElementById('dms-inputs');
    const textInputs = document.getElementById('text-inputs');
    const decimalBtn = document.getElementById('decimal-btn');
    const dmsBtn = document.getElementById('dms-btn');
    const textBtn = document.getElementById('text-btn');
    
    // –°–∫—Ä—ã–≤–∞–µ–º –≤—Å–µ –±–ª–æ–∫–∏
    decimalInputs.classList.add('hidden');
    dmsInputs.classList.add('hidden');
    textInputs.classList.add('hidden');
    
    // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Å—Ç–∏–ª–∏ –∫–Ω–æ–ø–æ–∫
    [decimalBtn, dmsBtn, textBtn].forEach(btn => {
        btn.classList.remove('bg-blue-500/30', 'border-blue-500/50');
        btn.classList.add('bg-white/10', 'border-white/20', 'hover:bg-white/20');
    });
    
    if (format === 'decimal') {
        decimalInputs.classList.remove('hidden');
        decimalBtn.classList.add('bg-blue-500/30', 'border-blue-500/50');
        decimalBtn.classList.remove('bg-white/10', 'border-white/20', 'hover:bg-white/20');
        
        // –î–µ–ª–∞–µ–º –¥–µ—Å—è—Ç–∏—á–Ω—ã–µ –ø–æ–ª—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏
        document.getElementById('lat').required = true;
        document.getElementById('lon').required = true;
    } else if (format === 'dms') {
        dmsInputs.classList.remove('hidden');
        dmsBtn.classList.add('bg-blue-500/30', 'border-blue-500/50');
        dmsBtn.classList.remove('bg-white/10', 'border-white/20', 'hover:bg-white/20');
        
        // –£–±–∏—Ä–∞–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å –¥–µ—Å—è—Ç–∏—á–Ω—ã—Ö –ø–æ–ª–µ–π
        document.getElementById('lat').required = false;
        document.getElementById('lon').required = false;
    } else if (format === 'text') {
        textInputs.classList.remove('hidden');
        textBtn.classList.add('bg-blue-500/30', 'border-blue-500/50');
        textBtn.classList.remove('bg-white/10', 'border-white/20', 'hover:bg-white/20');
        
        // –£–±–∏—Ä–∞–µ–º –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å –¥–µ—Å—è—Ç–∏—á–Ω—ã—Ö –ø–æ–ª–µ–π
        document.getElementById('lat').required = false;
        document.getElementById('lon').required = false;
    }
}

function convertDMSToDecimal() {
    try {
        // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è —à–∏—Ä–æ—Ç—ã
        const latDeg = parseFloat(document.getElementById('lat-deg').value) || 0;
        const latMin = parseFloat(document.getElementById('lat-min').value) || 0;
        const latSec = parseFloat(document.getElementById('lat-sec').value) || 0;
        const latDir = document.getElementById('lat-dir').value;
        
        // –ü–æ–ª—É—á–∞–µ–º –∑–Ω–∞—á–µ–Ω–∏—è –¥–æ–ª–≥–æ—Ç—ã
        const lonDeg = parseFloat(document.getElementById('lon-deg').value) || 0;
        const lonMin = parseFloat(document.getElementById('lon-min').value) || 0;
        const lonSec = parseFloat(document.getElementById('lon-sec').value) || 0;
        const lonDir = document.getElementById('lon-dir').value;
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        if (latDeg < 0 || latDeg > 90) {
            alert('–ì—Ä–∞–¥—É—Å—ã —à–∏—Ä–æ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç 0 –¥–æ 90');
            return;
        }
        if (lonDeg < 0 || lonDeg > 180) {
            alert('–ì—Ä–∞–¥—É—Å—ã –¥–æ–ª–≥–æ—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç 0 –¥–æ 180');
            return;
        }
        if (latMin < 0 || latMin >= 60) {
            alert('–ú–∏–Ω—É—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç 0 –¥–æ 59');
            return;
        }
        if (lonMin < 0 || lonMin >= 60) {
            alert('–ú–∏–Ω—É—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç 0 –¥–æ 59');
            return;
        }
        if (latSec < 0 || latSec >= 60) {
            alert('–°–µ–∫—É–Ω–¥—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç 0 –¥–æ 59.999');
            return;
        }
        if (lonSec < 0 || lonSec >= 60) {
            alert('–°–µ–∫—É–Ω–¥—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç 0 –¥–æ 59.999');
            return;
        }
        
        // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º –≤ –¥–µ—Å—è—Ç–∏—á–Ω—ã–µ –≥—Ä–∞–¥—É—Å—ã
        let lat = latDeg + (latMin / 60) + (latSec / 3600);
        let lon = lonDeg + (lonMin / 60) + (lonSec / 3600);
        
        // –ü—Ä–∏–º–µ–Ω—è–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        if (latDir === 'S') lat = -lat;
        if (lonDir === 'W') lon = -lon;
        
        // –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ 4 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
        lat = Math.round(lat * 10000) / 10000;
        lon = Math.round(lon * 10000) / 10000;
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–µ—Å—è—Ç–∏—á–Ω—ã–µ –ø–æ–ª—è
        document.getElementById('lat').value = lat;
        document.getElementById('lon').value = lon;
        
        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –¥–µ—Å—è—Ç–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
        switchFormat('decimal');
        
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        showNotification(`–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã: ${lat}, ${lon}`, 'success');
        
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç: ' + error.message, 'error');
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è DMS –ø–æ–ª–µ–π –ø—Ä–∏–º–µ—Ä–æ–º
function fillDMSExample() {
    // –ü—Ä–∏–º–µ—Ä: –°—É—Ä–≥—É—Ç (61¬∞15‚Ä≤00‚Ä≥ —Å. —à., 73¬∞26‚Ä≤00‚Ä≥ –≤. –¥.)
    document.getElementById('lat-deg').value = 61;
    document.getElementById('lat-min').value = 15;
    document.getElementById('lat-sec').value = 0;
    document.getElementById('lat-dir').value = 'N';
    
    document.getElementById('lon-deg').value = 73;
    document.getElementById('lon-min').value = 26;
    document.getElementById('lon-sec').value = 0;
    document.getElementById('lon-dir').value = 'E';
    
    document.getElementById('city_name').value = '–°—É—Ä–≥—É—Ç';
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
function parseTextCoordinates() {
    const text = document.getElementById('coord-text').value.trim();
    
    if (!text) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –¥–ª—è —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏—è', 'error');
        return;
    }
    
    try {
        let lat = null, lon = null;
        
        // –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç
        const patterns = [
            // 61¬∞15‚Ä≤00‚Ä≥ —Å. —à., 73¬∞26‚Ä≤00‚Ä≥ –≤. –¥.
            /(\d+)¬∞(\d+)‚Ä≤(\d+)‚Ä≥?\s*([—Å—éns])[.\s]*—à[.\s]*,?\s*(\d+)¬∞(\d+)‚Ä≤(\d+)‚Ä≥?\s*([–≤–∑ew])[.\s]*–¥[.\s]*/i,
            
            // 61¬∞15'00" N, 73¬∞26'00" E
            /(\d+)¬∞(\d+)'(\d+)"?\s*([ns]),?\s*(\d+)¬∞(\d+)'(\d+)"?\s*([ew])/i,
            
            // 61 15 00 N 73 26 00 E
            /(\d+)\s+(\d+)\s+(\d+)\s*([ns])\s+(\d+)\s+(\d+)\s+(\d+)\s*([ew])/i,
            
            // –î–µ—Å—è—Ç–∏—á–Ω—ã–µ: 61.25, 73.4333
            /(-?\d+\.?\d*),?\s*(-?\d+\.?\d*)/,
            
            // 61¬∞15‚Ä≤ —Å.—à. 73¬∞26‚Ä≤ –≤.–¥. (–±–µ–∑ —Å–µ–∫—É–Ω–¥)
            /(\d+)¬∞(\d+)‚Ä≤?\s*([—Å—éns])[.\s]*—à[.\s]*,?\s*(\d+)¬∞(\d+)‚Ä≤?\s*([–≤–∑ew])[.\s]*–¥[.\s]*/i,
            
            // 61¬∞ 15' N, 73¬∞ 26' E (–±–µ–∑ —Å–µ–∫—É–Ω–¥)
            /(\d+)¬∞\s*(\d+)'?\s*([ns]),?\s*(\d+)¬∞\s*(\d+)'?\s*([ew])/i
        ];
        
        for (let i = 0; i < patterns.length; i++) {
            const match = text.match(patterns[i]);
            
            if (match) {
                if (i === 3) { // –î–µ—Å—è—Ç–∏—á–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã
                    lat = parseFloat(match[1]);
                    lon = parseFloat(match[2]);
                } else if (i === 4 || i === 5) { // –ë–µ–∑ —Å–µ–∫—É–Ω–¥
                    const latDeg = parseInt(match[1]);
                    const latMin = parseInt(match[2]);
                    const latDir = match[3].toLowerCase();
                    const lonDeg = parseInt(match[4]);
                    const lonMin = parseInt(match[5]);
                    const lonDir = match[6].toLowerCase();
                    
                    lat = latDeg + (latMin / 60);
                    lon = lonDeg + (lonMin / 60);
                    
                    if (latDir === 's' || latDir === '—é') lat = -lat;
                    if (lonDir === 'w' || lonDir === '–∑') lon = -lon;
                } else { // –° —Å–µ–∫—É–Ω–¥–∞–º–∏
                    const latDeg = parseInt(match[1]);
                    const latMin = parseInt(match[2]);
                    const latSec = parseInt(match[3]);
                    const latDir = match[4].toLowerCase();
                    const lonDeg = parseInt(match[5]);
                    const lonMin = parseInt(match[6]);
                    const lonSec = parseInt(match[7]);
                    const lonDir = match[8].toLowerCase();
                    
                    lat = latDeg + (latMin / 60) + (latSec / 3600);
                    lon = lonDeg + (lonMin / 60) + (lonSec / 3600);
                    
                    if (latDir === 's' || latDir === '—é') lat = -lat;
                    if (lonDir === 'w' || lonDir === '–∑') lon = -lon;
                }
                break;
            }
        }
        
        if (lat === null || lon === null) {
            showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞—Å–ø–æ–∑–Ω–∞—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç.', 'error');
            return;
        }
        
        // –í–∞–ª–∏–¥–∞—Ü–∏—è
        if (lat < -90 || lat > 90) {
            showNotification('–®–∏—Ä–æ—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç -90 –¥–æ 90', 'error');
            return;
        }
        if (lon < -180 || lon > 180) {
            showNotification('–î–æ–ª–≥–æ—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç -180 –¥–æ 180', 'error');
            return;
        }
        
        // –û–∫—Ä—É–≥–ª—è–µ–º –¥–æ 4 –∑–Ω–∞–∫–æ–≤ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
        lat = Math.round(lat * 10000) / 10000;
        lon = Math.round(lon * 10000) / 10000;
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –¥–µ—Å—è—Ç–∏—á–Ω—ã–µ –ø–æ–ª—è
        document.getElementById('lat').value = lat;
        document.getElementById('lon').value = lon;
        
        // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –Ω–∞ –¥–µ—Å—è—Ç–∏—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç
        switchFormat('decimal');
        
        showNotification(`–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω—ã: ${lat}, ${lon}`, 'success');
        
    } catch (error) {
        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç: ' + error.message, 'error');
    }
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–∏–º–µ—Ä–∞
function fillTextExample() {
    document.getElementById('coord-text').value = '61¬∞15‚Ä≤00‚Ä≥ —Å. —à., 73¬∞26‚Ä≤00‚Ä≥ –≤. –¥.';
    document.getElementById('city_name').value = '–°—É—Ä–≥—É—Ç';
    switchFormat('text');
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–∫–æ–Ω–æ–∫
document.addEventListener('DOMContentLoaded', function() {
    if (typeof lucide !== 'undefined') {
        lucide.createIcons();
    }

    const form = document.getElementById('custom-city-form');
    if (!form) {
        return;
    }

    form.addEventListener('submit', function(event) {
        const submitBtn = form.querySelector('button[type="submit"]');
        const lat = parseFloat(document.getElementById('lat').value);
        const lon = parseFloat(document.getElementById('lon').value);

        if (Number.isNaN(lat) || Number.isNaN(lon)) {
            event.preventDefault();
            showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã –≤ –¥–µ—Å—è—Ç–∏—á–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π —Ñ–æ—Ä–º—ã.', 'error');
            return;
        }

        if (lat < -90 || lat > 90) {
            event.preventDefault();
            showNotification('–®–∏—Ä–æ—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç -90 –¥–æ 90.', 'error');
            document.getElementById('lat').focus();
            return;
        }

        if (lon < -180 || lon > 180) {
            event.preventDefault();
            showNotification('–î–æ–ª–≥–æ—Ç–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ –æ—Ç -180 –¥–æ 180.', 'error');
            document.getElementById('lon').focus();
            return;
        }

        // Deterministic loading state for submit flow
        if (submitBtn) {
            submitBtn.disabled = true;
            submitBtn.innerHTML = `
                <div class="flex items-center justify-center gap-2">
                    <div class="w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin"></div>
                    <span>–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö...</span>
                </div>
            `;
        }
    });
});
</script>
<div id="custom-notification-live" class="sr-only" aria-live="polite"></div>
{% endblock %}
