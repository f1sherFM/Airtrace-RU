<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}AirTrace RU — Мониторинг качества воздуха{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="/static/style.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { font-family: 'Inter', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.1); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.2); }
        
        /* Улучшенная цветовая схема AQI */
        .aqi-gradient { background: linear-gradient(135deg, #00b4db 0%, #0083b0 100%); }
        
        /* Хорошее качество - мягкий зеленый */
        .aqi-good { background: linear-gradient(135deg, #10b981 0%, #059669 100%); }
        
        /* Умеренное - приглушенный желто-зеленый */
        .aqi-moderate { background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); }
        
        /* Вредно для чувствительных - мягкий оранжевый */
        .aqi-unhealthy-sensitive { background: linear-gradient(135deg, #f97316 0%, #ea580c 100%); }
        
        /* Вредно - приглушенный красный */
        .aqi-unhealthy { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        
        /* Очень вредно - темно-фиолетовый */
        .aqi-very-unhealthy { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%); }
        
        /* Опасно - темно-бордовый */
        .aqi-hazardous { background: linear-gradient(135deg, #991b1b 0%, #7f1d1d 100%); }
        
        .loading { animation: pulse 2s infinite; }
        .error { background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%); }
        .city-input { background: rgba(255, 255, 255, 0.15); backdrop-filter: blur(8px); }
        .forecast-card { transition: all 0.3s ease; }
        .forecast-card:hover { transform: translateY(-2px); }
        
        /* Дополнительные улучшения */
        .glass-dark { background: rgba(0, 0, 0, 0.15); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .text-shadow { text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3); }
        
        /* Улучшенные переходы */
        * { transition: background-color 0.3s ease, color 0.3s ease; }
        
        /* Исправление для select элемента */
        .city-select {
            background: rgba(255, 255, 255, 0.15) !important;
            backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white !important;
            border-radius: 12px;
            padding: 8px 12px;
            outline: none;
            transition: all 0.3s ease;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='white' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 16px;
            padding-right: 32px;
        }
        
        .city-select:focus {
            border-color: rgba(59, 130, 246, 0.5);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .city-select option {
            background: #1f2937 !important;
            color: white !important;
            padding: 8px !important;
        }
        
        .city-select option:hover {
            background: #374151 !important;
        }
        
        .city-select option:checked,
        .city-select option:selected {
            background: #3b82f6 !important;
            color: white !important;
        }
        
        /* Адаптивные улучшения для мобильных */
        @media (max-width: 768px) {
            .glass, .glass-enhanced { backdrop-filter: blur(8px); }
            body { padding: 1rem; }
        }

        /* A11y: visible keyboard focus and skip-link */
        :focus-visible {
            outline: 3px solid #fbbf24;
            outline-offset: 2px;
            border-radius: 8px;
        }

        .skip-link {
            position: absolute;
            left: 12px;
            top: -40px;
            background: #111827;
            color: #ffffff;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.3);
            z-index: 1000;
            transition: top 0.2s ease;
        }

        .skip-link:focus {
            top: 12px;
        }
    </style>
    {% block extra_head %}{% endblock %}
</head>
<body class="{% block body_class %}aqi-gradient{% endblock %} min-h-screen text-white p-4 md:p-8">
    <a href="#main-content" class="skip-link">Перейти к основному содержанию</a>

    <div class="max-w-6xl mx-auto">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4" role="banner">
            <div>
                <h1 class="text-3xl font-bold flex items-center gap-3">
                    <i data-lucide="wind" class="text-blue-200 w-8 h-8"></i> 
                    <a href="/" class="hover:text-blue-200 transition-colors">AirTrace RU</a>
                </h1>
                <p class="text-blue-100 text-sm opacity-80 mt-1">
                    {% block location_display %}Выберите город для мониторинга{% endblock %}
                </p>
            </div>
            
            <!-- City Selection -->
            <div class="flex flex-col md:flex-row gap-3 w-full md:w-auto" aria-label="Панель навигации и обновления">
                <!-- Кастомный dropdown -->
                {% include 'custom_select.html' %}
                
                <div class="flex gap-2">
                    <a href="/alerts/settings" class="btn-glass rounded-xl px-4 py-2 flex items-center gap-2" aria-label="Открыть настройки алертов">
                        <i data-lucide="bell" class="w-4 h-4"></i>
                        <span class="hidden md:inline">Алерты</span>
                    </a>
                    {% if current_city %}
                    {% if is_custom %}
                    <form method="post" action="/custom">
                        <input type="hidden" name="lat" value="{{ current_city.lat }}">
                        <input type="hidden" name="lon" value="{{ current_city.lon }}">
                        <input type="hidden" name="city_name" value="{{ current_city.name }}">
                        <button type="submit" class="btn-glass rounded-xl px-4 py-2 flex items-center gap-2" aria-label="Обновить данные текущих координат">
                            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                            <span class="hidden md:inline">Обновить</span>
                        </button>
                    </form>
                    {% else %}
                    <form method="post" action="/refresh/{{ city_key }}">
                        <button type="submit" class="btn-glass rounded-xl px-4 py-2 flex items-center gap-2" aria-label="Обновить данные выбранного города">
                            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                            <span class="hidden md:inline">Обновить</span>
                        </button>
                    </form>
                    {% endif %}
                    {% endif %}
                    
                    <div class="flex items-center gap-2" aria-live="polite" aria-label="Состояние backend API">
                        <span class="w-2 h-2 rounded-full {% if api_status == 'healthy' %}bg-green-500{% else %}bg-red-500{% endif %}"></span>
                        <span class="text-xs">
                            {% if api_status == 'healthy' %}API активен{% else %}API недоступен{% endif %}
                        </span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Content -->
        <main id="main-content" role="main" tabindex="-1">
            {% block content %}{% endblock %}
        </main>

        <!-- Footer -->
        <footer class="mt-12 text-center opacity-60 text-xs" role="contentinfo">
            <p>© 2026 AirTrace RU. Данные: Open-Meteo API. Стандарты ПДК РФ. Privacy-first архитектура.</p>
        </footer>
    </div>

    <script>
        // Инициализация иконок Lucide
        lucide.createIcons();
    </script>
    {% block extra_scripts %}{% endblock %}
</body>
</html>
